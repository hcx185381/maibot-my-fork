╔═══════════════════════════════════════════════════════════════════╗
║                                                                   ║
║              Git历史查看指南 - 查找API密钥泄露记录                  ║
║                                                                   ║
╚═══════════════════════════════════════════════════════════════════╝


═══════════════════════════════════════════════════════════════════════════════
                          安全提醒
═══════════════════════════════════════════════════════════════════════════════

⚠️ 重要提示:

您的API密钥在以下提交中存在:
├── a7d9e975 (2026-02-02) - 优化MaiBot配置
└── 之前的提交可能也包含

已通过以下提交移除:
└── 85a84fd6 (刚刚) - 从GitHub移除敏感配置文件

当前状态:
✅ GitHub最新版本不再包含API密钥
⚠️ Git历史记录中仍有API密钥
✅ 本地文件保留，MaiBot正常运行


═══════════════════════════════════════════════════════════════════════════════
                    查看Git历史的命令
═══════════════════════════════════════════════════════════════════════════════

方法1：查看最近10条提交（简洁版）
────────────────────────────────────────────────────────────────
git log --oneline -10

输出示例:
85a84fd6 🔒 从GitHub移除敏感配置文件（保护API密钥）
5c705a01 🔒 移除API密钥并添加日志查看工具
a7d9e975 🔧 优化MaiBot配置：移除代理依赖，增强表情包功能、添加模型切换工具
...


方法2：查看最近10条提交（详细版）
────────────────────────────────────────────────────────────────
git log -10

显示:
- 完整的提交信息
- 作者
- 时间
- 修改的文件


方法3：图形化查看历史
────────────────────────────────────────────────────────────────
git log --graph --oneline --all

显示分支合并的树状结构


方法4：查看某个文件的历史
────────────────────────────────────────────────────────────────
git log --follow docker-config/mmc/model_config.toml

查看model_config.toml的完整历史


方法5：查看某次提交的详细内容
────────────────────────────────────────────────────────────────
git show a7d9e975

查看提交a7d9e975的详细修改内容


方法6：查看某次提交中特定文件
────────────────────────────────────────────────────────────────
git show a7d9e975:docker-config/mmc/model_config.toml

查看a7d9e975提交时的model_config.toml内容


═══════════════════════════════════════════════════════════════════════════════
                  查找包含API密钥的历史记录
═══════════════════════════════════════════════════════════════════════════════

搜索包含API密钥的提交:
────────────────────────────────────────────────────────────────
git log -S "89a2bbde7e784556a0bd2ba1b6403e53" --oneline

搜索包含"89a2bbde..."的提交（GLM API Key）

git log -S "sk-d38850098a9540b7a88ded9e311f2a46" --oneline

搜索包含"sk-d388..."的提交（DeepSeek API Key）


查看哪些提交包含敏感文件:
────────────────────────────────────────────────────────────────
git log --oneline -- docker-config/mmc/model_config.toml

显示所有修改过model_config.toml的提交


═══════════════════════════════════════════════════════════════════════════════
                      风险评估
═══════════════════════════════════════════════════════════════════════════════

当前安全状况:
────────────────────────────────────────────────────────────────
✅ GitHub最新版本: 安全（无API密钥）
⚠️ Git历史记录: 风险（包含API密钥）
✅ 本地配置文件: 正常（MaiBot可使用）

风险等级: 🟡 中等
────────────────────────────────────────────────────────────────
为什么是中等风险？
• 普通用户查看仓库页面：看不到API密钥 ✅
• 需要翻Git历史才能找到API密钥 ⚠️
• 知道Git命令的人可以找到 ⚠️
• 大多数用户不会查看Git历史 ✅


风险降低方案:
────────────────────────────────────────────────────────────────
方案1: 保持现状（推荐）
• 优点: 不需要更换API密钥
• 优点: MaiBot继续正常使用
• 缺点: 历史记录中仍有密钥
• 适用: 私人仓库，信任访问者

方案2: 更换API密钥（最安全）
• 优点: 彻底消除风险
• 缺点: 需要重新配置
• 缺点: 余额可能需要迁移
• 适用: 公开仓库，完全安全

方案3: 使仓库私有
• 优点: 限制访问
• 缺点: GitHub私有仓库有限制
• 适用: 完全不想公开


═══════════════════════════════════════════════════════════════════════════════
                    实际操作演示
═══════════════════════════════════════════════════════════════════════════════

在MaiBot目录下打开命令行:

1. 查看最近5次提交
────────────────────────────────────────────────────────────────
cd /d E:\github ai xiangmu\MaiBot
git log --oneline -5


2. 查看包含API密钥的提交
────────────────────────────────────────────────────────────────
git log -S "89a2bbde7e784556a0bd2ba1b6403e53" --oneline

预期输出:
a7d9e975 🔧 优化MaiBot配置...


3. 查看那次提交中的文件
────────────────────────────────────────────────────────────────
git show a7d9e975:docker-config/mmc/model_config.toml | grep api_key

会看到:
api_key = "89a2bbde7e784556a0bd2ba1b6403e53.JIYEhnC8GNmW3qte"
api_key = "sk-d38850098a9540b7a88ded9e311f2a46"


4. 确认最新版本已移除
────────────────────────────────────────────────────────────────
git show HEAD:docker-config/mmc/model_config.toml

预期输出:
error: pathspec 'docker-config/mmc/model_config.toml' did not match...

这说明文件已从Git中移除 ✅


═══════════════════════════════════════════════════════════════════════════════
                      常用Git历史命令
═══════════════════════════════════════════════════════════════════════════════

简洁查看:
────────────────────────────────────────────────────────────────
git log --oneline              ← 一行一个提交
git log --oneline -10          ← 最近10条
git log --oneline --all        ← 所有分支
git log --oneline --graph      ← 树状图


详细查看:
────────────────────────────────────────────────────────────────
git log                        ← 完整信息
git log -10                    ← 最近10条
git log --patch                ← 显示修改内容
git log --stat                 ← 显示文件统计


查看差异:
────────────────────────────────────────────────────────────────
git diff HEAD~1                ← 对比上一个版本
git diff a7d9e975 85a84fd6     ← 对比两个提交
git diff HEAD                  ← 对比未提交的修改


═══════════════════════════════════════════════════════════════════════════════
                      GitHub网页查看
═══════════════════════════════════════════════════════════════════════════════

直接在浏览器查看:
────────────────────────────────────────────────────────────────
1. 访问: https://github.com/hcx185381/maibot-my-fork
2. 点击 "commits" (提交数)
3. 查看提交历史
4. 点击提交可查看详细内容

注意:
✅ 最新提交(85a84fd6): 不包含model_config.toml
⚠️ 之前提交(a7d9e975): 包含model_config.toml（有API密钥）


═══════════════════════════════════════════════════════════════════════════════
                        建议
═══════════════════════════════════════════════════════════════════════════════

短期建议:
────────────────────────────────────────────────────────────────
✅ 已完成: 从GitHub移除敏感文件
✅ 已完成: 本地文件保留，MaiBot正常运行
⚠️ 建议做: 定期检查API使用记录
   - GLM: https://open.bigmodel.cn/usercenter/apikeys
   - DeepSeek: https://platform.deepseek.com/api_keys


长期建议:
────────────────────────────────────────────────────────────────
1. 监控API使用量（每周检查）
   - 看是否有异常调用
   - 检查消费金额

2. 如果发现异常:
   - 立即禁用当前API密钥
   - 重新生成新密钥
   - 更新本地配置

3. 考虑将仓库设为私有（可选）
   - Settings → Danger Zone → Change visibility
   - 选择 "Private"

4. 使用环境变量（最佳实践）
   - 不要在配置文件中硬编码API密钥
   - 使用环境变量或密钥管理服务


═══════════════════════════════════════════════════════════════════════════════
                        快捷命令
═══════════════════════════════════════════════════════════════════════════════

创建一个批处理文件来快速检查:
────────────────────────────────────────────────────────────────

@echo off
echo 检查Git历史中是否包含API密钥...
echo.
git log -S "89a2bbde7e784556a0bd2ba1b6403e53" --oneline
echo.
git log -S "sk-d38850098a9540b7a88ded9e311f2a46" --oneline
echo.
pause


═══════════════════════════════════════════════════════════════════════════════
                              END
═══════════════════════════════════════════════════════════════════════════════
