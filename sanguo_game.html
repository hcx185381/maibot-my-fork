<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三国演义人物关系小游戏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #gameContainer {
            width: 1200px;
            height: 800px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 20px;
            padding: 20px;
            position: relative;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }

        #infoBar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 24px;
        }

        #score {
            color: #FFD700;
            font-weight: bold;
        }

        #combo {
            color: #FFD700;
            font-weight: bold;
            font-size: 28px;
            text-shadow: 0 0 10px #FFD700;
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        #lives {
            color: #FF6B6B;
            font-size: 24px;
        }

        #timer {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }

        #progressBar {
            width: 100%;
            height: 25px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            border: 2px solid white;
        }

        #progressFill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.1s linear, background 0.3s;
            border-radius: 15px;
        }

        #questionArea {
            text-align: center;
            margin: 40px 0;
        }

        #questionText {
            font-size: 48px;
            margin-bottom: 20px;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        #characterName {
            font-size: 72px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            margin: 30px 0;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
            50% { text-shadow: 0 0 50px rgba(255, 215, 0, 1); }
        }

        #optionsContainer {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 40px;
        }

        .option {
            width: 500px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 3px solid white;
            border-radius: 15px;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .option:nth-child(even) {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .option:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            border-color: #FFD700;
        }

        .option:active {
            transform: scale(0.98);
        }

        #gameOverScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 20px;
        }

        #gameOverScreen.show {
            display: flex;
        }

        #gameOverText {
            font-size: 64px;
            color: #FF6B6B;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.8);
        }

        #finalScore {
            font-size: 48px;
            color: #FFD700;
            margin-bottom: 30px;
        }

        #restartHint {
            font-size: 24px;
            color: white;
            margin-top: 20px;
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #FFD700;
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 10px #FFD700;
        }

        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0);
            }
        }

        .correct-answer {
            animation: correctFlash 0.5s;
        }

        @keyframes correctFlash {
            0%, 100% { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            50% { background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%); }
        }

        .wrong-answer {
            animation: wrongShake 0.5s;
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="infoBar">
            <div id="score">分数: 0</div>
            <div id="combo" style="display: none;">连击 x0!</div>
            <div id="lives">生命: ❤️❤️❤️</div>
        </div>

        <div id="timer">时间: 10秒</div>
        <div id="progressBar">
            <div id="progressFill"></div>
        </div>

        <div id="questionArea">
            <div id="questionText">主公是？</div>
            <div id="characterName">刘备</div>
        </div>

        <div id="optionsContainer">
            <div class="option" data-option="0">A. 选项1</div>
            <div class="option" data-option="1">B. 选项2</div>
            <div class="option" data-option="2">C. 选项3</div>
            <div class="option" data-option="3">D. 选项4</div>
        </div>

        <div id="gameOverScreen">
            <div id="gameOverText">游戏结束！</div>
            <div id="finalScore">最终分数: 0</div>
            <div id="restartHint">按 R 键或点击屏幕重新开始</div>
        </div>
    </div>

    <script>
        // 游戏配置
        const TIME_LIMIT = 10;
        const INITIAL_LIVES = 3;

        // 三国人物数据
        const CHARACTERS_DATA = {
            "刘备": {lord: "刘备", faction: "蜀汉", relation: "君主"},
            "关羽": {lord: "刘备", faction: "蜀汉", relation: "义兄弟"},
            "张飞": {lord: "刘备", faction: "蜀汉", relation: "义兄弟"},
            "诸葛亮": {lord: "刘备", faction: "蜀汉", relation: "军师"},
            "赵云": {lord: "刘备", faction: "蜀汉", relation: "武将"},
            "马超": {lord: "刘备", faction: "蜀汉", relation: "武将"},
            "黄忠": {lord: "刘备", faction: "蜀汉", relation: "武将"},
            "魏延": {lord: "刘备", faction: "蜀汉", relation: "武将"},
            "姜维": {lord: "刘禅", faction: "蜀汉", relation: "武将"},
            "刘禅": {lord: "刘禅", faction: "蜀汉", relation: "君主"},
            
            "曹操": {lord: "曹操", faction: "曹魏", relation: "君主"},
            "曹丕": {lord: "曹丕", faction: "曹魏", relation: "君主"},
            "曹植": {lord: "曹操", faction: "曹魏", relation: "公子"},
            "夏侯惇": {lord: "曹操", faction: "曹魏", relation: "族弟"},
            "夏侯渊": {lord: "曹操", faction: "曹魏", relation: "族弟"},
            "张辽": {lord: "曹操", faction: "曹魏", relation: "武将"},
            "徐晃": {lord: "曹操", faction: "曹魏", relation: "武将"},
            "张郃": {lord: "曹操", faction: "曹魏", relation: "武将"},
            "许褚": {lord: "曹操", faction: "曹魏", relation: "护卫"},
            "典韦": {lord: "曹操", faction: "曹魏", relation: "护卫"},
            "荀彧": {lord: "曹操", faction: "曹魏", relation: "谋士"},
            "郭嘉": {lord: "曹操", faction: "曹魏", relation: "谋士"},
            "司马懿": {lord: "曹操", faction: "曹魏", relation: "谋士"},
            
            "孙权": {lord: "孙权", faction: "东吴", relation: "君主"},
            "孙策": {lord: "孙策", faction: "东吴", relation: "君主"},
            "周瑜": {lord: "孙权", faction: "东吴", relation: "都督"},
            "鲁肃": {lord: "孙权", faction: "东吴", relation: "都督"},
            "吕蒙": {lord: "孙权", faction: "东吴", relation: "都督"},
            "陆逊": {lord: "孙权", faction: "东吴", relation: "都督"},
            "甘宁": {lord: "孙权", faction: "东吴", relation: "武将"},
            "太史慈": {lord: "孙策", faction: "东吴", relation: "武将"},
            "黄盖": {lord: "孙权", faction: "东吴", relation: "老将"},
            "程普": {lord: "孙权", faction: "东吴", relation: "老将"},
            "韩当": {lord: "孙权", faction: "东吴", relation: "老将"},
        };

        const QUESTION_TYPES = ["lord", "faction", "relation"];
        const QUESTION_TEXT_MAP = {
            "lord": "主公是？",
            "faction": "所属势力是？",
            "relation": "与主公的关系是？"
        };

        class Game {
            constructor() {
                this.score = 0;
                this.lives = INITIAL_LIVES;
                this.combo = 0;
                this.currentCharacter = null;
                this.currentQuestionType = null;
                this.options = [];
                this.correctAnswer = null;
                this.timeLeft = TIME_LIMIT;
                this.gameOver = false;
                this.timerInterval = null;
                this.particles = [];

                this.initElements();
                this.generateQuestion();
                this.startTimer();
                this.setupEventListeners();
            }

            initElements() {
                this.scoreEl = document.getElementById('score');
                this.comboEl = document.getElementById('combo');
                this.livesEl = document.getElementById('lives');
                this.timerEl = document.getElementById('timer');
                this.progressFillEl = document.getElementById('progressFill');
                this.questionTextEl = document.getElementById('questionText');
                this.characterNameEl = document.getElementById('characterName');
                this.optionsContainerEl = document.getElementById('optionsContainer');
                this.gameOverScreenEl = document.getElementById('gameOverScreen');
                this.finalScoreEl = document.getElementById('finalScore');
            }

            generateQuestion() {
                const characters = Object.keys(CHARACTERS_DATA);
                this.currentCharacter = characters[Math.floor(Math.random() * characters.length)];
                this.currentQuestionType = QUESTION_TYPES[Math.floor(Math.random() * QUESTION_TYPES.length)];

                const correctData = CHARACTERS_DATA[this.currentCharacter];
                this.correctAnswer = correctData[this.currentQuestionType];

                // 收集所有可能的答案
                const allAnswers = new Set();
                Object.values(CHARACTERS_DATA).forEach(charData => {
                    allAnswers.add(charData[this.currentQuestionType]);
                });

                // 生成错误答案
                let wrongAnswers = Array.from(allAnswers).filter(ans => ans !== this.correctAnswer);
                
                // 确保至少有3个错误答案（如果不够则重复）
                while (wrongAnswers.length < 3) {
                    wrongAnswers = wrongAnswers.concat(wrongAnswers.slice(0, 3 - wrongAnswers.length));
                }

                // 随机选择3个错误答案
                wrongAnswers = this.shuffleArray(wrongAnswers).slice(0, 3);
                
                // 组合并打乱选项
                this.options = [this.correctAnswer, ...wrongAnswers];
                this.options = this.shuffleArray(this.options);

                this.updateDisplay();
                this.timeLeft = TIME_LIMIT;
            }

            shuffleArray(array) {
                const arr = [...array];
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                return arr;
            }

            updateDisplay() {
                this.questionTextEl.textContent = QUESTION_TEXT_MAP[this.currentQuestionType];
                this.characterNameEl.textContent = this.currentCharacter;

                const optionElements = this.optionsContainerEl.querySelectorAll('.option');
                optionElements.forEach((el, i) => {
                    if (i < this.options.length) {
                        el.textContent = `${String.fromCharCode(65 + i)}. ${this.options[i]}`;
                        el.style.display = 'block';
                    } else {
                        el.style.display = 'none';
                    }
                });

                this.scoreEl.textContent = `分数: ${this.score}`;
                this.livesEl.textContent = `生命: ${'❤️'.repeat(this.lives)}`;

                if (this.combo > 1) {
                    this.comboEl.textContent = `连击 x${this.combo}!`;
                    this.comboEl.style.display = 'block';
                } else {
                    this.comboEl.style.display = 'none';
                }
            }

            checkAnswer(selectedOption) {
                if (this.gameOver) return;

                const optionIndex = this.options.indexOf(selectedOption);
                const optionEl = this.optionsContainerEl.querySelectorAll('.option')[optionIndex];

                if (selectedOption === this.correctAnswer) {
                    // 答对了
                    this.score += 1;
                    this.combo += 1;

                    // 连击加成
                    const comboBonus = Math.max(0, Math.floor((this.combo - 1) / 3));
                    this.score += comboBonus;

                    // 特效
                    optionEl.classList.add('correct-answer');
                    setTimeout(() => optionEl.classList.remove('correct-answer'), 500);
                    this.createParticles();

                    this.generateQuestion();
                } else {
                    // 答错了
                    this.lives -= 1;
                    this.combo = 0;

                    optionEl.classList.add('wrong-answer');
                    setTimeout(() => optionEl.classList.remove('wrong-answer'), 500);

                    if (this.lives <= 0) {
                        this.endGame();
                    } else {
                        this.generateQuestion();
                    }
                }

                this.updateDisplay();
            }

            createParticles() {
                const container = document.getElementById('gameContainer');
                const centerX = container.offsetWidth / 2;
                const centerY = container.offsetHeight / 2 - 50;

                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = centerX + 'px';
                    particle.style.top = centerY + 'px';
                    
                    const angle = (Math.PI * 2 * i) / 20;
                    const speed = Math.random() * 3 + 2;
                    const vx = Math.cos(angle) * speed;
                    const vy = Math.sin(angle) * speed - 3;

                    container.appendChild(particle);

                    let x = centerX;
                    let y = centerY;
                    let opacity = 1;
                    const animate = () => {
                        x += vx;
                        y += vy;
                        opacity -= 0.02;
                        vy += 0.2; // 重力

                        particle.style.left = x + 'px';
                        particle.style.top = y + 'px';
                        particle.style.opacity = opacity;

                        if (opacity > 0) {
                            requestAnimationFrame(animate);
                        } else {
                            particle.remove();
                        }
                    };
                    animate();
                }
            }

            startTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                }

                this.timerInterval = setInterval(() => {
                    if (this.gameOver) {
                        clearInterval(this.timerInterval);
                        return;
                    }

                    this.timeLeft -= 0.1;
                    if (this.timeLeft <= 0) {
                        this.timeLeft = 0;
                        this.lives -= 1;
                        this.combo = 0;
                        
                        if (this.lives <= 0) {
                            this.endGame();
                        } else {
                            this.generateQuestion();
                        }
                    }

                    this.updateTimer();
                }, 100);
            }

            updateTimer() {
                const seconds = Math.max(0, Math.ceil(this.timeLeft));
                this.timerEl.textContent = `时间: ${seconds}秒`;

                const progress = Math.max(0, this.timeLeft / TIME_LIMIT);
                this.progressFillEl.style.width = (progress * 100) + '%';

                // 颜色变化
                if (this.timeLeft < 3) {
                    this.progressFillEl.style.background = 'linear-gradient(90deg, #f5576c, #f093fb)';
                    this.timerEl.style.color = '#FF6B6B';
                } else if (this.timeLeft < 5) {
                    this.progressFillEl.style.background = 'linear-gradient(90deg, #FFD700, #FFA500)';
                    this.timerEl.style.color = '#FFD700';
                } else {
                    this.progressFillEl.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
                    this.timerEl.style.color = '#4CAF50';
                }
            }

            endGame() {
                this.gameOver = true;
                clearInterval(this.timerInterval);
                this.finalScoreEl.textContent = `最终分数: ${this.score}`;
                this.gameOverScreenEl.classList.add('show');
            }

            restart() {
                this.score = 0;
                this.lives = INITIAL_LIVES;
                this.combo = 0;
                this.gameOver = false;
                this.gameOverScreenEl.classList.remove('show');
                this.generateQuestion();
                this.startTimer();
            }

            setupEventListeners() {
                // 选项点击
                this.optionsContainerEl.addEventListener('click', (e) => {
                    if (this.gameOver) return;
                    const optionEl = e.target.closest('.option');
                    if (optionEl) {
                        const index = parseInt(optionEl.dataset.option);
                        if (index < this.options.length) {
                            this.checkAnswer(this.options[index]);
                        }
                    }
                });

                // 键盘事件
                document.addEventListener('keydown', (e) => {
                    if (this.gameOver) {
                        if (e.key === 'r' || e.key === 'R') {
                            this.restart();
                        }
                        return;
                    }

                    const keyMap = {
                        'a': 0, 'A': 0,
                        'b': 1, 'B': 1,
                        'c': 2, 'C': 2,
                        'd': 3, 'D': 3
                    };

                    if (keyMap.hasOwnProperty(e.key) && keyMap[e.key] < this.options.length) {
                        this.checkAnswer(this.options[keyMap[e.key]]);
                    }
                });

                // 游戏结束屏幕点击重新开始
                this.gameOverScreenEl.addEventListener('click', () => {
                    this.restart();
                });
            }
        }

        // 启动游戏
        window.addEventListener('DOMContentLoaded', () => {
            new Game();
        });
    </script>
</body>
</html>

